<!--
 * @Author: chenbei
 * @Date: 2022-04-04 20:30:37
 * @LastEditTime: 2022-04-04 20:35:07
 * @FilePath: \myLeetCode\代码整洁之道.md
 * @Description: 代码整洁之道.md
 * @Signature: A boy without dreams
-->
## 一、整洁代码

本书提到的东西都是为了以下几点。

1、代码能够通过所有测试

2、没有重复代码

3、体现系统中的全部设计理念

4、包括尽量少的实体，比如类、方法和函数等

"让营地比你来时更干净"，确保每次签入代码时都会比签出时干净，代码就不会产生腐坏

## 二、有意义的命名

1、如果命名需要注释来补充，就不算名副其实的命名。

```c++
int d; // daliy day
```

2、一段代码要明确做的是什么事情，输入是什么？返回可用于做什么？如果有一些判断，例如和某个常量是否相等的比较，这个常量是什么含义？

好的方法是用合适的命名标记输入和输出，常量改用一个只读函数来返回，函数名就可以告知常量的含义。

3、避免误导。如不要使用过于相似的单词表示2个变量，尽量避免使用小写字母"l"和大小写字母"O"和"o"。

4、做有意义的区分。例如使用"Name"和"NameString"，名字又不会是数字，它必然是字符串，还有"theMessage"和"Message"其实也没区别，"the"不过是废话。

5、避免使用自造词，将某些单词闲的蛋疼的缩写，或者几个单词的前几位拼在一起。

6、如果是常量，应提供可搜索的名称，如数字7很容易找错，如果提供enum之类的可能更好。

7、尽量不要使用命名前缀，因为读代码比较快时这些前后缀只会被忽略。

```C++
string m_des; // x
string description; // √
```

8、避免使用编码来区分抽象接口和实现。例如一个人的抽象基类可被命名为IPersonFactory，具体类实现可被命名为PersonFactory，实际上前导字母"I"是废话可能有干扰作用，而且也不希望客户知道这是接口。最好是抽象基类使用不加修饰的名称PersonFactory，而具体类的名称可以是PersonFactoryImp。

9、类名和对象名应是名词或名词短语而不是动词或者简称，避免Data或Info的类名。

10、方法名应是动词或动词短语，例如获取名字，"getName"，设定值"setValue"，而不是直接使用"name"和"value"。

11、不要使用笑话或者典故来命名某些函数，例如打篮球的函数palyBasketball不要命名为"运动的蔡徐坤"，CaiXukunOfSports，它可能会给你发律师函哦~

12、使用一以贯之的命名方法，一个概念对应一个词，例如get、fetch和retrieve都有相似的意思，但是如果存在2个函数名为getValue以及fetchValue，就可能搞不懂啥意思。

13、使用技术名称，而非经济术语、数学名称等，程序员可能不具备这些知识。

14、添加有意义的语境。例如firstName改为addFirstName，可以让读者明白这个函数可能是更大的结构一部分。好的做法是提供一个类，这样编译器也可以知道firstName是某个类的成员函数。

## 三、函数

1、函数要尽可能的短小，只做一件事，且做好这件事

2、每个函数是一个抽象层级，让函数内部调用的是下一抽象层级的函数

3、少使用switch语句，改使用多态。

```java
public Money calculatePay(Employee e)
throws InvalidEmployeeType{
    switch (e.type){
        case COMMISSIONED:
            return calculateCommissionPay(e);
        case HOURLY:
            return calculateHourlyPay(e);
        case SALARIED:
            return calculateSalaried(e);
        default:
            throw new InvalidEmployeeType(e.type);
    }
}
```

这样的代码首先太长，做了很多事情，而且它会变得更长；其次违反单一权责SRP原则，即修改它可以很多理由；最后，它违反开放闭合OCP原则，因为每当添加新类型时，这个函数就必须修改，并且也会因为这样的函数存在就要设置其他函数来处理这样的返回流程，那样的函数想必也会使用switch语句。

好的做法是改用多态性质，创建一个类来描述这样的流程，好处在于虽然也使用了switch语句，但是只会出现一次，它可以被继承添加新的类型。

```java
public abstract class Employee{ //抽象基类
    public abstract boolean isPayday();
    public abstract Money calculatePay();
    public abstract void deliverPay(Money pay);
}
public interface EmployeeFactory{//接口类
    public Employee makeEmployee(EmployeeRecord r) throws InvalidEmployeeType; // 工厂函数
}
public class EmployeeFactoryImpl implements EmployeeFactory{//具体类
    public Employee makeEmployee(EmployeeRecord r) throws InvalidEmployeeType{
        switch (r.type){
            case COMMISSIONED:
              	return calculateCommissionPay(r);
            case HOURLY:
            	return calculateHourlyPay(r);
        	case SALARIED:
            	return calculateSalaried(r);
        	default:
            	throw new InvalidEmployeeType(r.type);
        }
    }
}
```

4、函数应避免使用三个及以上的参数，因为测试用例的组合值可能会很复杂，可能无法提供覆盖所有执行路径测试的用例。此时应将一些参数封装为类，这样个对象可能可以提供多个原有的参数，例如点类(x,y)使用单参Point p就比双参数double x,y更好。

5、鼓励使用单参数函数，如果存在返回值可以看成是参数转换类型的过程，如果没有返回值可以看成是一种事件，这些都容易理解。

6、不要把bool类型提供给函数作为参数。

7、分隔指令和询问，不要在if判断中做两件事，例如，设置某个属性，成功返回true否则返回false。

```java
if (set("username","cb"))
```

但是在读者看来好像是，如果username之前是"cb"然后做些什么，而不是要将username设置为"cb"看看是否可行然后做些什么。将指令设置动作和询问分开，即

```java
if (isExist("username")){
    setName("cb");
}
```

8、使用异常替代返回错误码，可以从主路径代码中分离出来，即try块内是主程序，catch是错误处理，而不是混合的深层嵌套。同时错误码可能是一组枚举类型，如果需要新的错误码就需要重新编译，而异常可以被继承和派生，无需重新编译。

9、对try_catch也可以进一步剥离，不要直接使用try_catch。

```java
try{
    dosomething();
    deletesomething();
    ...
}
catch(Exception e){
    procesError();
    ...
}
```

可以改为

```java
public void delete(){//只与错误处理有关
    try{
        deletesomething();
    }
    catch(Exception e){
        log(e);
    }
}
private void deletesomething(){ 
    ...
}
private void log(){
    procesError();
    ...
}
```

## 四、注释

